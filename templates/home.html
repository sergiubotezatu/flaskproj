{%extends "base.html"%}
{%block title%}Home{%endblock%}
{%block content%}
{%with messages = get_flashed_messages()%}
  {%if messages%}
    {%for note in messages%}
    <div class="success">
   </br>
      <strong><p>{{note}}</p></strong>
    </div>
    {%endfor%}
    {%endif%}
{%endwith%}
<div class="filters">
  <p style = "color:white;margin-top:24px;">Filter posts</p>
    <input type="text" placeholder="Search.." id="search" onkeyup="filterFunction()">
    <div id="found" class="users">
    {%if '?' in url%}
    {%set ns = namespace(path = url)%}
    {%else%}
    {%set ns = namespace(path = '?')%}
    {%endif%}
      {%for i in range(filters["user_id"]|length)%}
      {%set name = filters["name"][i]%}
      {%set userid = filters["user_id"][i] %}
      {%if i == 0%}
        <span>Clear all<a href = "/" id = "x">x</a></span>
        {%endif%}
        <span>{{name}}
          <form style = "display:inline"method = "Post">
        <input type = "hidden" name = "name" value = {{name}}>
        <input type = "hidden" id = "id" name = "user_id" value = {{userid}}>
        <input style = "font-size: medium;" type = "submit" id = "x" name = "rmv_id" value = "x">
      </form>
      </span>
    </a>
    {%endfor%}
    {%for user in users%}
    <a href="{{ '%suser_id=%s&name=%s&'|format(ns.path, user[0], user[1])}}">{{user[1]}}</a>
    {%endfor%}
    </div>
</div>
<div class="row">
  {%if allposts|length == 0%}
  <div class = "post">
    <h3 class = "item" style ="margin-left:auto;margin-right:auto;">Filtered users have no more posts</h3>
  </div>
  {%endif%}
{% for item in allposts%}
      <div class="column">
      {%if item[0] == "Ch1"%}
      <a href= "/post/create" style ="color:black; text-decoration:none; ">
      {%else%}
      <a href="{{ '/post/read/%s'%item[0]|urlencode }}" style ="color:black; text-decoration:none; ">
      {%endif%}
        <div class="post" title ="Click to Read More">
         <h3 class = "item" style ="margin-left:auto;margin-right:auto;">{{item[1].title}}</h3>
         <h4 class = "item" class ="higlight">by {{item[1].auth}}</h4>
         <div class = "item" style ="text-align:justify;">{{item[1].content}}</div>
        <span class = "item" style = "float: right">{{item[1].created}}</span>
        </div>
      </a>
    </div>
    {%endfor%}
  </div>
  <div class = "pages">
  {%if pg != 1%}
  {%set prev = (pg - 1)|string%}
  <a href="{{ '%spg=%s&'|format(ns.path, prev) }}" class="pg-arr">&laquo; Previous</a>
  {%endif%}
  {%if next%}
  {%set next = (pg + 1)|string%}
  <a href="{{ '%spg=%s&'|format(ns.path, next) }}" class="pg-arr">Next &raquo;</a>
  {%endif%}
  </div>
{%endblock%}